!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cgusf_script-js",[],e):"object"==typeof exports?exports["cgusf_script-js"]=e():t["cgusf_script-js"]=e()}(self,(function(){return(()=>{"use strict";var t={};return(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t),jQuery(document).ready((function(t){t.fn.cgusfSeeMoreLess=function(e,i){var s=t(this).closest(".cgusf__list"),o=i||["See More","See Less"],n=o[0],a=o[1];this.each((function(){var o=t(this).children(".cgusf__post-message"),c=o.html(),r=c.length>e?c.substring(0,e)+"...":c;if(""===i)c.length>e&&o.html(r);else if(c.length>e){c=t.cgusfLinkify(c),r=t.cgusfLinkify(r),o.html(r);let e=t('<p class="cgusf__seemore">'+n+"</p>"),i=o.siblings(".cgusf__seemore");0===i.length?o.after(e):e=i,e.removeClass("expanded"),e.click((function(){e.toggleClass("expanded"),e.hasClass("expanded")?(e.html(a),o.html(c)):(e.html(n),o.html(r)),void 0!==s.masonry&&t(s).masonry("layout")}))}}))},t.fn.cgusfReposition=function(e){let i={target:t(this),type:e.type,proportion:e.proportion,init:function(){let e=this,i=function(i){"contain"===e.type&&e.contain(t(i))};t("body").on("cgusf-lightbox-opened",(function(){i(e.target)})),t(window).on("resize",(function(){i(e.target)}))},contain:function(t){let e=t.parent(),i=this.proportion,s=Math.round(e.height()/e.width()*100)/100;i&&(s>i?(t.width(e.width()),t.height(t.width()*i)):(t.height(e.height()),t.width(t.height()*(1+i))))}};return i.init(),i},t.fn.cgusfRepositionImage=function(e){let i={selector:{img:"img"},target:t(this),type:e.type,imgSelector:e.imgSelector,parentSelector:e.parentSelector,init:function(){let e=this,i=function(i){"cover"===e.type&&e.cover(t(i)),"contain"===e.type&&e.contain(t(i))};t(e.target).find(e.imgSelector).each((function(e,s){t(s).on("load",(function(){i(s)})),t(window).on("resize",(function(){i(s)}))}))},cover:function(e){let i=t(e).parent(),s=parseInt(i.outerWidth()),o=parseInt(i.outerHeight()),n=Math.round(o/s*100)/100,a=t(e).parents(this.parentSelector).first();n>Math.round(t(a).data("image-h")/t(a).data("image-w")*100)/100?(t(e).height(o),t(e).css("margin-left","-"+(t(e).width()-s)/2+"px"),t(e).css("margin-top",0)):(t(e).width(s),t(e).css("margin-top","-"+(t(e).height()-o)/2+"px"),t(e).css("margin-left",0))},contain:function(e){let i,s,o=e.parent(),n=t(e).closest(this.parentSelector),a=parseInt(t(n).attr("data-image-w")),c=parseInt(t(n).attr("data-image-h"));if(!a||!c)return e.css("height",""),e.css("width",""),!1;i=Math.round(c/a*100)/100,s=Math.round(o.height()/o.width()*100)/100,s>i?(e.width(o.width()),e.height(e.width()*i)):(i=Math.round(a/c*100)/100,e.height(o.height()),e.width(e.height()*i))}};return i.init(),i},t.fn.cgusfIsInViewport=function(){var e=t(this).offset().top,i=e+t(this).outerHeight(),s=t(window).scrollTop(),o=s+t(window).height();return i>s&&e<o},t.cgusfLinkify=function(t){if(t){var e=t.replace(/(\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,'<a href="$1" target="_blank">$1</a>');return e.replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a href="http://$2" target="_blank">$2</a>')}return t}})),jQuery(document).ready((function(t){t.fn.cgusfLightbox=function(){return{selector:{post:".cgusf__item",postText:".cgusf__post-text",rightArrow:".cgusf__arrow-r"},currentPost:null,target:t(this),init:function(){return this.feedId=this.target.data("id"),this.modal=this.target.children(".cgusf__lb"),0!==this.modal.length&&(this.modalBg=this.modal.find(".cgusf__bg"),this.modalPost=this.modal.find(".cgusf__post"),this.modalPostInfo=this.modalPost.find(".cgusf__info"),this.modalPostMeta=this.modalPost.find(".cgusf__post-stats"),this.modalPostTime=this.modalPost.find(".cgusf__post-time"),this.modalPostMedia=this.modalPost.find(".cgusf__post-media"),this.modalPostVideo=this.modalPostMedia.find(".cgusf__video").first(),this.modalPostVideoIframe=this.modalPostVideo.find("iframe"),this.modalComments=this.modalPost.find(".cgusf__comments"),this.modalImg=this.modalPostMedia.find(".cgusf__img img").first(),this.accountImgWrapper=this.modal.find(".cgusf__account-img"),this.accountImg=this.accountImgWrapper.find("img"),this.accountImgLink=this.accountImgWrapper.find(".cgusf__account-img-link"),this.accountName=this.modal.find(".cgusf__account-author"),this.leftControl=this.modal.find(".cgusf__arrow-l"),this.rightControl=this.leftControl.siblings(".cgusf__arrow-r"),this.slider=this.modalPostMedia.find(".cgusf__lb-slider"),this.isInitSlider=!1,this.initEvents(),this.initPlugins(),!0)},initEvents:function(){let e=this;e.leftControl.click((function(){let i=t(e.currentPost).prev(e.selector.post);if(0===i.length)return!1;e.refreshContent(i),e.refreshControls()})),e.rightControl.click((function(){let i=t(e.currentPost).next(e.selector.post);if(0===i.length)return!1;e.refreshContent(i),e.refreshControls()})),e.modal.find(".cgusf__bg , .cgusf__cross").click((function(){e.hideModal()}))},initPlugins:function(){t(self.modal).cgusfRepositionImage({type:"contain",imgSelector:".cgusf__img img",parentSelector:".cgusf__wrapper"})},initNewItem:function(e){let i=this;e.find(".cgusf__post-img-link").click((function(){i.refreshContent(t(this).closest(i.selector.post)),i.showModal()}))},showModal(){let e=this;e.refreshControls(),e.modal.show(),e.modalPost.animate({animate:1},{duration:300,step:function(t){e.modal.css({opacity:2*t}),e.modalPost.css({transform:"scale("+(1.1-.1*t)+")"})},complete:function(){t("body").trigger("cgusf-lightbox-opened")}})},refreshControls(){let e=this,i=t(this.currentPost).prev(this.selector.post),s=t(this.currentPost).next(this.selector.post);0===i.length?e.leftControl.hide():e.leftControl.show(),0===s.length&&e.target.trigger("cgusf:fetch:posts")},hideModal(){let t=this;t.modalPost.animate({animate:0},{duration:300,step:function(e){t.modal.css({opacity:e}),t.modalPost.css({transform:"scale("+(.1-.1*e+1)+")"})},complete:function(){t.modal.hide(),t.setVideoTagSource("",t.modalPostMedia.find(".cgusf__video"),""),t.isInitSlider&&t.unSlickPostAlbum()}})},fixHeight:function(e){this.modal.find(this.selector.postText).height(t(this.modalPostInfo).height())},getPostData:t=>window.cgusf_data.items.find((function(e){return e.id==t})),getPostSource:t=>window.cgusf_data.sources[t],refreshContent:function(e){let i=this;if(1===e.length){i.currentPost=e;let s=i.getPostData(i.currentPost.data("id")),o=i.getPostSource(e.data("source"));i.accountName.attr("href",o.account.link).text(o.account.name),o.account.picture?(i.accountImg.attr("src",o.account.picture),i.accountImgLink.attr("href",o.account.link),i.accountImgLink.removeClass("empty"),i.accountImg.show()):(i.accountImgLink.addClass("empty"),i.accountImg.hide()),i.modalPostMeta.find(".cgusf__icon--likes .num").text(s.like_count),i.modalPostMeta.find(".cgusf__icon--shares .num").text(s.share_count),i.modalPostMeta.find(".cgusf__icon--comments .num").text(s.comment_count),i.modalPostTime.html(s.date);let n=t('<div class="cgusf__post-text"><p class="cgusf__post-message"></p></div>');t(n).children(".cgusf__post-message").html(s.message),t(n).cgusfSeeMoreLess(100),i.modalPostInfo.html(n),i.unsetMedia();let a=i.modalPostMedia.find(".cgusf__img"),c=a.children("img").first();s.atch_video?(i.modalPostVideo.show(),i.setVideoTagSource(s,o),a.hide()):s.atch_image?(a.show(),c.attr("src",s.atch_image),i.modalPostVideo.hide()):(a.hide(),i.modalPostVideo.hide()),s.children?(i.slider.hide(),i.slickPostAlbum(),t(s.children).each((function(e,s){let o=t("<div class='cgusf__slide'></div>");0===e&&o.addClass("active"),o.attr("data-src",s.media_url),o.css("background-image","url('"+s.media_url+"')"),o.click((function(e){c.attr("src",t(e.target).data("src")),i.slider.find(".cgusf__slide").removeClass("active"),t(e.target).addClass("active")})),i.slider.slick("slickAdd",o)}))):i.unSlickPostAlbum(),s.comments?(i.modalComments.show(),i.renderCommentsBlock(s)):i.modalComments.hide()}},renderCommentsBlock:function(e){let i=this;void 0===i.commentTemplate&&(i.commentTemplate=i.modalComments.html()),i.modalComments.empty();let s=t(i.commentTemplate),o=s.find(".cgusf__comment-author-img"),n=s.find(".cgusf__comment-message"),a=s.find(".cgusf__comment-meta");t(e.comments).each((function(t,e){o.find("a").attr("href",e.link),o.find("img").attr("src",e.picture),n.find(".cgusf__comment-author-name").attr("href",e.link).text(e.name),n.find("p").text(e.message),a.find(".cgusf__comment-date").text(e.date),i.modalComments.append('<div class="cgusf__comment">'+s.html()+"</div>")}))},setVideoTagSource:function(t,e){let i=this,s="";i.resetVideoTag(),t.atch_video&&("facebook"===t.vendor?(s="https://www.facebook.com/plugins/video.php?show_text=false&t=0&height=280&width=500",s+="&href=https://www.facebook.com/"+e.account.id+"/videos/"+t.atch_target_id):("instagram"===t.vendor||"youtube"===t.vendor)&&(s=t.atch_video),i.modalPostVideoIframe.attr("src",s).show(),i.modalPostVideoIframe.cgusfReposition({type:"contain",proportion:.56}))},resetVideoTag:function(){this.modalPostVideoIframe.attr("src","").hide()},unsetMedia:function(){this.modalPostMedia.find(".cgusf__img").children("img").first().attr("src",""),this.resetVideoTag()},slickPostAlbum:function(){if(!1===this.isInitSlider)this.isInitSlider=!0,this.slider.slick({arrows:!0,slide:".cgusf__slide",slidesToShow:4,slidesToScroll:1});else{let t=this.slider.slick("getSlick").slideCount;for(let e=0;e<t;e++)this.slider.slick("slickRemove",0);this.slider.empty(),this.slider.slick("refresh")}this.slider.show(),this.modalPostMedia.addClass("slider")},unSlickPostAlbum:function(){this.slider.hide(),this.isInitSlider&&(this.isInitSlider=!1,this.modalPostMedia.removeClass("slider"),this.slider.slick("unslick"),this.slider.empty())}}}})),jQuery(document).ready((function(t){t.fn.cgusfViewBuilder=function(e){this.loadTypes={scroll:"load-scroll",btn:"load-btn"},this.selector={inputPaginationToken:"div.cgusf__pagination_token",controls:".cgusf__controls",loadBtn:".cgusf__load-button",loadWrapper:".cgusf__loader-wrapper",commentsBtn:".cgusf__post-stats",comments:".cgusf__comments",item:".cgusf__item",itemsData:'div[data-type="cgusf-data"]',accImage:".cgusf__account-img",accAuthor:".cgusf__account-author",message:".cgusf__post-message"},this.init=function(e){let i=this;this.wrapper=t(this),this.feedId=this.wrapper.data("id"),this.list=this.wrapper.find(".cgusf__list"),this.isMasonry=this.isEnabledMasonry(),this.isSlider=this.isEnabledSlider(),this.loadingType=this.wrapper.data("load-type"),this.isSeeMore=this.wrapper.data("see-more"),this.isSeeMore="string"===t.type(this.isSeeMore)?JSON.parse(this.isSeeMore):this.isSeeMore,this.feedType=this.getFeedType(),this.enable=!0,this.loading=!0,this.feedLayout=this.getFeedLayout(),this.feedAdmin=e,this.lightbox=null,this.mountPluginDataObject(),this.loadFeedSources(),this.initialPostsLoad(),this.initMasonry(),this.isSlider&&this.initSlider(),"post"===this.feedType&&(this.initSeeMoreLess(this.wrapper),this.initClickComments()),this.initLightbox(),t("body").on("cgusf:fetch:posts:after",(function(t){"photo"===i.feedType&&i.repositionImages()})),this.loadingType===this.loadTypes.scroll?this.isSlider||this.initInfinityScroll():this.loadingType===this.loadTypes.btn?this.isSlider||this.initClickButtonLoad():this.disableLoading()},this.isEnabledMasonry=function(){return this.wrapper.find(".cgusf__list").hasClass("masonry")},this.isEnabledSlider=function(){return this.wrapper.find(".cgusf__list").hasClass("slider")},this.getFeedType=function(){return this.list.hasClass("photo")?"photo":this.wrapper.hasClass("post")?"post":""},this.getFeedLayout=function(){return this.list.hasClass("list")?"list":this.wrapper.hasClass("grid")?"grid":this.wrapper.hasClass("masonry")?"masonry":""},this.getColByDevice=function(t){let e=this.list.attr("class").split(/\s+/),i="";for(let s=0;s<e.length;s++)if(e[s].indexOf(t+"-col-")>=0){i=e[s];break}return i.slice(-1)},this.initSlider=function(){let t=this;t.list.slick({dots:!0,arrows:!0,slide:".cgusf__item",slidesToShow:t.getColByDevice("d"),slidesToScroll:1,responsive:[{breakpoint:1024,settings:{slidesToShow:t.getColByDevice("t"),slidesToScroll:1,infinite:!0,dots:!0}},{breakpoint:600,settings:{slidesToShow:t.getColByDevice("m"),slidesToScroll:1}}]})},this.initClickButtonLoad=function(){let t=this;t.wrapper.find(t.selector.loadBtn).on("click",(function(){t.loading=!0,t.fetchPostsAjax()}))},this.initClickComments=function(){let t=this;this.wrapper.find(t.selector.commentsBtn).on("click",(function(){t.wrapper.find(t.selector.comments).toggleClass("active")}))},this.initMasonry=function(){let t=this;t.isMasonry&&t.list.imagesLoaded((function(){t.list.masonry({item:".cgusf__item",gutter:t.wrapper.data("padding"),percentPosition:!0,columnWidth:".masonry-sizer"})}))},this.initSeeMoreLess=function(t){let e="list"===this.feedLayout?300:200;t.find(".cgusf__post-text").cgusfSeeMoreLess(e,this.isSeeMore)},this.initialPostsLoad=function(){this.fetchPostsAjax(!0)},this.initLightbox=function(){let e=this,i=t(e.wrapper).cgusfLightbox();i.init()&&(e.lightbox=i,e.wrapper.on("cgusf:fetch:posts",(function(t){e.fetchPostsAjax()})))},this.repositionImages=function(){t(this.wrapper).cgusfRepositionImage({type:"cover",imgSelector:".cgusf__item img",parentSelector:".cgusf__item"})},this.addNewItemsToLightbox=function(t){this.lightbox&&this.lightbox.initNewItem(t)},this.updateItemHtml=function(e){let i=this;t.each(e,(function(e,s){let o=i.getFeedSource(t(s).data("source")),n=i.getItemData(t(s).data("id")),a=o.account,c=o.account.picture;void 0!==o.account.picture_custom&&(c=o.account.picture_custom),t(s).find(".cgusf__post-text").children(i.selector.message).html(t.parseHTML(i.getItemMessage(n.message))),t(s).find(i.selector.accImage).children("img").attr("src",c),t(s).find(i.selector.accAuthor).text(a.name).attr("href",a.link)}))},this.getItemMessage=function(t){return t.replace(/(\r\n|\r|\n)/g,"<br>")},this.getFeedSource=function(t){return window.cgusf_data.sources[t]},this.getItemData=function(t){return!!window.cgusf_data.items&&window.cgusf_data.items.find((function(e){return e.id==t}))},this.loadFeedSources=function(){let e=this,i=e.wrapper.data("id");t.ajax({type:"POST",url:cgusf_ajax_obj.ajax_url,async:!1,data:{_ajax_nonce:cgusf_ajax_obj.nonce,action:"fetch_feed_sources",feed_id:i,sources:e.feedAdmin?e.feedAdmin.config.source:""},success:function(t){Object.assign(window.cgusf_data.sources,t)}})},this.fetchPostsAjax=function(e=!1){let i=this;i.enable&&!0===i.loading&&(i.wrapper.addClass("loading"),t.post(cgusf_ajax_obj.ajax_url,{_ajax_nonce:cgusf_ajax_obj.nonce,action:"fetch_feed_posts",feed_id:i.wrapper.data("id"),feed:i.feedAdmin,pagination_token:i.getPaginationToken()},(function(s){let o=t(s).filter(i.selector.item);i.setItemsData(s),i.loading=!1,i.removePaginationToken(),i.wrapper.removeClass("loading"),i.loadingType===i.loadTypes.btn&&t(i.selector.loadWrapper).remove(),0===o.length?i.disableLoading():(i.updateItemHtml(o),i.isMasonry?(i.list.append(o).masonry("appended",o),i.list.imagesLoaded().progress((function(){i.list.masonry("layout")}))):i.list.append(o),i.list.append(t(s).filter(i.selector.inputPaginationToken)),i.initSeeMoreLess(o),i.addNewItemsToLightbox(o),i.isSlider&&i.list.slick("refresh"),e&&i.loadingType===i.loadTypes.btn&&i.wrapper.find(i.selector.loadBtn).show(),t("body").trigger("cgusf:fetch:posts:after"))})))},this.setItemsData=function(e){let i=t(e).filter(this.selector.itemsData).first().text();i&&(window.cgusf_data.items=window.cgusf_data.items.concat(JSON.parse(i)))},this.initInfinityScroll=function(){let e=this,i=function(i,s){let o;return function(...i){clearTimeout(o),o=setTimeout((()=>{clearTimeout(o),function(){!1===e.loading&&t(e.selector.controls).cgusfIsInViewport()&&(e.loading=!0,e.fetchPostsAjax())}(...i)}),0)}}();window.addEventListener("scroll",i)},this.removePaginationToken=function(){let t=this.wrapper.find(this.selector.inputPaginationToken);0!==t.length&&t.remove()},this.getPaginationToken=function(){let t=this.wrapper.find(this.selector.inputPaginationToken);return t.length>=0?t.attr("data-token"):""},this.disableLoading=function(){this.enable=!1,this.hideLoadButton()},this.hideLoadButton=function(){this.wrapper.find(this.selector.loadBtn).hide()},this.mountPluginDataObject=function(){void 0===window.cgusf_data&&(window.cgusf_data={}),window.cgusf_data.sources={},window.cgusf_data.items=[]},this.init(e)}})),t})()}));